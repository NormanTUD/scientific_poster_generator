<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Responsive Grid with Editable Boxes</title>
		<style>
.grid {
	display: flex;
	flex-wrap: wrap;
	width: 100%;
	margin: 0;
	padding: 0;
}
    .grid-item {
	    flex: 1;
	    margin: 10px;
	    padding: 10px;
	    border: 1px solid gray;
	    background-color: #f1f1f1;
    }
    .grid-item textarea {
	    width: 100%;
	    height: 200px;
	    resize: none;
	    border: 0;
	    padding: 10px;
	    font-size: 16px;
    }
		</style>
	</head>
	<body>
		<div id="gridContainer">
			<button id="addBoxBtn">Add New Box</button>
			<div class="grid">
			</div>
		</div>

		<script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
		<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
		<script type="text/x-mathjax-config">
			MathJax.Hub.Config({
				tex2jax: {
					inlineMath: [['$','$']]
				},
				jax: ["input/TeX","output/CommonHTML"],
				"showMathMenu": true
			});
		</script>
		<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"></script>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">

		<script>
			const gridContainer = document.getElementById("gridContainer");
			const addBoxBtn = document.getElementById("addBoxBtn");
			const grid = document.querySelector(".grid");
			let activeBox = null;

			addBoxBtn.addEventListener("click", function () {
				const newBox = document.createElement("div");
				newBox.classList.add("grid-item");
				newBox.innerHTML = `
	<div class="content">
	  Default text
	</div>
      `;
				grid.appendChild(newBox);

				newBox.addEventListener("click", function () {
					if (activeBox) {
						activeBox.querySelector(".content").innerHTML = marked.marked(
							activeBox.querySelector("textarea").value
						);
						/*
						renderMathInElement(activeBox, {
							delimiters: [
								{ left: "$$", right: "$$", display: true },
								{ left: "$", right: "$", display: false },
							],
						});
						 */
					}
					activeBox = newBox;
					newBox.querySelector(".content").innerHTML = `
	  <textarea>Default text</textarea>
	`;
					newBox.querySelector("textarea").focus();


newBox.querySelector("textarea").addEventListener("blur", function () {
        newBox.querySelector(".content").innerHTML = marked.marked(this.value);
        MathJax.Hub.Queue(["Typeset", MathJax.Hub, newBox.querySelector(".content")]);
        // Insert code to handle image upload and markdown formatting here
        const textarea = newBox.querySelector("textarea");
        textarea.addEventListener("drop", (e) => {
          e.preventDefault();
          const files = Array.from(e.dataTransfer.files);
          files.forEach((file) => {
            const formData = new FormData();
            formData.append("file", file);
            fetch("upload.php", {
              method: "POST",
              body: formData,
            })
              .then((res) => res.text())
              .then((fileName) => {
                textarea.value += `![](${fileName})`;
                textarea.dispatchEvent(new Event("input"));
              });
          });
        });
        textarea.addEventListener("input", () => {
          newBox.querySelector(".content").innerHTML = marked.marked(textarea.value);
          MathJax.Hub.Queue(["Typeset", MathJax.Hub, newBox.querySelector(".content")]);
        });
      });


				});
			});
		</script>
	</body>
</html>

